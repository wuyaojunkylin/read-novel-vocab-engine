<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- é˜²æ­¢æµè§ˆå™¨è‡ªåŠ¨ç¿»è¯‘ -->
    <meta name="google" content="notranslate">
    <meta http-equiv="Content-Language" content="zh-CN">
    <title>å­¦ä¹ ç»Ÿè®¡ - 50ç¯‡å°è¯´èƒŒå•è¯</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* ========== å…¨å±€æ ·å¼ ========== */
        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333333;
            line-height: 1.6;
            padding: 20px;
        }

        /* ========== å®¹å™¨æ ·å¼ ========== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ========== é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ ========== */
        .top-navigation {
            /* å¼¹æ€§å¸ƒå±€ï¼šæ¨ªå‘æ’åˆ—å¯¼èˆªé“¾æ¥ */
            display: flex;
            /* é“¾æ¥é—´è· */
            gap: 24px;
            /* åº•éƒ¨é—´è· */
            margin-bottom: 30px;
            /* é¡¶éƒ¨å†…è¾¹è· */
            padding-top: 10px;
            /* åº•éƒ¨å†…è¾¹è· */
            padding-bottom: 10px;
            /* åº•éƒ¨è¾¹æ¡†ï¼šåˆ†éš”å¯¼èˆªå’Œå†…å®¹ */
            border-bottom: 1px solid #e5e5e5;
        }

        /* å¯¼èˆªé“¾æ¥æ ·å¼ */
        .nav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #347474;
            text-decoration: none;
            font-size: 1.05rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            padding: 6px 10px;
            border-radius: 6px;
            border: none;
            background: none;
            cursor: pointer;
        }

        /* å¯¼èˆªé“¾æ¥æ‚¬åœæ•ˆæœ */
        .nav-link:hover {
            /* æ‚¬åœæ—¶é¢œè‰²å˜æ·± */
            color: #285f5f;
            /* æ‚¬åœæ—¶èƒŒæ™¯è‰² */
            background-color: #e8f1f1;
        }

        /* å¯¼èˆªå›¾æ ‡æ ·å¼ */
        .nav-link svg {
            /* å›¾æ ‡å®½åº¦ */
            width: 16px;
            /* å›¾æ ‡é«˜åº¦ */
            height: 16px;
            /* å›¾æ ‡é¢œè‰²ï¼šç»§æ‰¿æ–‡å­—é¢œè‰² */
            fill: currentColor;
            /* é˜²æ­¢å›¾æ ‡ç¼©å° */
            flex-shrink: 0;
        }

        /* å“åº”å¼è®¾è®¡ï¼šå°å±å¹•é€‚é… */
        @media (max-width: 600px) {
            .top-navigation {
                /* å‡å°é“¾æ¥é—´è· */
                gap: 12px;
                /* å…è®¸æ¢è¡Œ */
                flex-wrap: wrap;
            }

            .nav-link {
                font-size: 0.95rem;
                padding: 5px 8px;
            }

            .nav-link svg {
                /* è°ƒæ•´å›¾æ ‡å¤§å° */
                width: 14px;
                height: 14px;
            }
        }

        /* ========== æ ‡é¢˜æ ·å¼ ========== */
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #111111;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666666;
            font-size: 1rem;
            margin-bottom: 40px;
        }

        /* ========== ç»Ÿè®¡å¡ç‰‡æ ·å¼ ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }

        .stat-card-title {
            font-size: 0.9rem;
            color: #666666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2e9eb7;
            margin-bottom: 5px;
        }

        .stat-card-unit {
            font-size: 0.85rem;
            color: #999999;
        }

        /* ========== å›¾è¡¨å®¹å™¨æ ·å¼ ========== */
        .chart-section {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111111;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        /* ========== å®Œæˆç¥è´ºæ ·å¼ ========== */
        #completion-celebration {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #e6f7ff 0%, #f0f9ff 100%);
            border-radius: 12px;
            border: 2px solid #2e9eb7;
            text-align: center;
        }

        .celebration-message h3 {
            font-size: 1.5rem;
            color: #2e9eb7;
            margin: 0 0 10px 0;
            font-weight: 700;
        }

        .celebration-message p {
            font-size: 1rem;
            color: #666666;
            margin: 0 0 20px 0;
            line-height: 1.6;
        }

        .reset-btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            background-color: #2e9eb7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 12px rgba(46, 158, 183, 0.3);
        }

        .reset-btn:hover {
            background-color: #2189a8;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 158, 183, 0.4);
        }

        .reset-btn:active {
            transform: translateY(0);
        }

        /* ========== æ•…äº‹è¿›åº¦åˆ—è¡¨æ ·å¼ ========== */
        .story-progress-list {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .story-progress-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .story-progress-item:last-child {
            border-bottom: none;
        }

        .story-progress-title {
            flex: 1;
            font-weight: 500;
            color: #333333;
            margin-right: 20px;
        }

        .story-progress-bar-container {
            flex: 2;
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 15px;
        }

        .story-progress-bar {
            height: 100%;
            background-color: #2e9eb7;
            border-radius: 4px;
            transition: width 0.3s ease-in-out;
        }

        .story-progress-percentage {
            min-width: 60px;
            text-align: right;
            font-weight: 600;
            color: #2e9eb7;
            font-size: 0.9rem;
        }

        /* ========== ç©ºçŠ¶æ€æ ·å¼ ========== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999999;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 1.1rem;
        }

        /* ========== å“åº”å¼è®¾è®¡ ========== */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .story-progress-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .story-progress-bar-container {
                width: 100%;
                margin: 10px 0;
            }

            .chart-container {
                height: 250px;
            }
        }

        /* ===== ç‰ˆæƒé¡µè„šæ ·å¼ ===== */
        .site-footer {
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 2rem; /* ç¡®ä¿å’Œé¡µé¢å†…å®¹æœ‰ä¸€å®šé—´è· */
            border-top: 1px solid #eee; /* ä¸€æ¡ç»†å¾®çš„åˆ†å‰²çº¿ */
        }
        .site-footer p {
            margin: 0;
            font-size: 0.85em; /* å­—ä½“å°ä¸€ç‚¹ */
            color: #999; /* é¢œè‰²æ·¡ä¸€ç‚¹ï¼Œä¸æŠ¢çœ¼ */
        }
    </style>
    <script type="module" src="/src/js/main.js"></script>
</head>
<body>
    <div class="container">
        <!-- ========== é¡¶éƒ¨å¯¼èˆªæ  ========== -->
        <nav class="top-navigation">
            <a href="index.html" class="nav-link">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                </svg>
                æ•…äº‹åˆ—è¡¨
            </a>
            <a href="words.html" class="nav-link">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                </svg>
                æˆ‘çš„ç”Ÿè¯æœ¬
            </a>
            <span class="nav-link" style="color: #347474; cursor: default; background-color: transparent;">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3v18h18v-2H5V3H3zm4 12h2v4H7v-4zm4-4h2v8h-2v-8zm4-4h2v12h-2V7z"/>
                </svg>
                å­¦ä¹ ç»Ÿè®¡
            </span>
            <a href="settings.html" class="nav-link">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09A1.65 1.65 0 0 0 15 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9c.34.27.76.42 1.2.42H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                è®¾ç½®
            </a>
            <a href="guide.html" class="nav-link">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.8"/>
                    <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                    <circle cx="12" cy="8" r="1" fill="currentColor"/>
                </svg>
                ä½¿ç”¨è¯´æ˜
            </a>
        </nav>

        <!-- ========== æ ‡é¢˜ ========== -->
        <h1>å­¦ä¹ ç»Ÿè®¡</h1>
        <p class="subtitle">è¿½è¸ªä½ çš„å­¦ä¹ è¿›åº¦å’Œæˆå°±</p>

        <!-- ========== ç»Ÿè®¡å¡ç‰‡ ========== -->
        <div class="stats-grid" id="stats-grid">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- ========== å­¦ä¹ æ—¶é•¿å›¾è¡¨ ========== -->
        <div class="chart-section">
            <h2 class="chart-title">å­¦ä¹ æ—¶é•¿è¶‹åŠ¿</h2>
            <div class="chart-container">
                <canvas id="timeChart"></canvas>
            </div>
        </div>

        <!-- ========== å­¦ä¹ è¿›åº¦å›¾è¡¨ ========== -->
        <div class="chart-section">
            <h2 class="chart-title">æ•´ä½“å­¦ä¹ è¿›åº¦</h2>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
            <!-- å®Œæˆç¥è´ºå’Œé‡ç½®æŒ‰é’®åŒºåŸŸ -->
            <div id="completion-celebration" style="display: none;">
                <div class="celebration-message">
                    <h3>ğŸ‰ æ­å–œä½ ï¼å·²å®Œæˆæ‰€æœ‰æ•…äº‹ï¼</h3>
                    <p>ä½ å·²æˆåŠŸå®Œæˆæ‰€æœ‰ 50 ç¯‡æ•…äº‹çš„å­¦ä¹ ï¼Œè¿™æ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„æˆå°±ï¼</p>
                </div>
                <button id="reset-progress-btn" class="reset-btn">å¼€å§‹æ–°ä¸€è½®å­¦ä¹ </button>
            </div>
        </div>

        <!-- ========== å„æ•…äº‹å­¦ä¹ è¿›åº¦ ========== -->
        <div class="story-progress-list">
            <h2 class="chart-title">å„æ•…äº‹å­¦ä¹ è¿›åº¦</h2>
            <div id="story-progress-list">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

    </div>

    <script>
        // æ ¼å¼åŒ–æ—¶é—´å‡½æ•°
        function formatTime(minutes) {
            if (minutes < 60) {
                return minutes.toFixed(0);
            }
            const hours = Math.floor(minutes / 60);
            const mins = Math.floor(minutes % 60);
            return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
        }
    </script>
    <script>
        /**
         * å­¦ä¹ ç»Ÿè®¡é¡µé¢ä¸»é€»è¾‘
         */

        // ========== è·å–å­¦ä¹ æ•°æ® ==========
        let learningData = null;
        let stats = null;

        // ========== æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡ ==========
        function renderStatCards() {
            const statsGrid = document.getElementById('stats-grid');
            const cards = [
                {
                    title: 'æ€»å­¦ä¹ æ—¶é•¿',
                    value: formatTime(stats.totalTime),
                    unit: 'åˆ†é’Ÿ'
                },
                {
                    title: 'ä»Šæ—¥å­¦ä¹ æ—¶é•¿',
                    value: formatTime(stats.todayTime),
                    unit: 'åˆ†é’Ÿ'
                },
                {
                    title: 'æœ¬å‘¨å­¦ä¹ æ—¶é•¿',
                    value: formatTime(stats.weekTime),
                    unit: 'åˆ†é’Ÿ'
                },
                {
                    title: 'å·²å®Œæˆæ•…äº‹',
                    value: stats.completedStories,
                    unit: `/ ${stats.totalStories} ç¯‡`
                },
                {
                    title: 'æ€»ä½“è¿›åº¦',
                    value: stats.totalProgress.toFixed(1),
                    unit: '%'
                },
                {
                    title: 'è¿ç»­å­¦ä¹ å¤©æ•°',
                    value: stats.consecutiveDays,
                    unit: 'å¤©'
                }
            ];

            statsGrid.innerHTML = cards.map(card => `
                <div class="stat-card">
                    <div class="stat-card-title">${card.title}</div>
                    <div class="stat-card-value">${card.value}</div>
                    <div class="stat-card-unit">${card.unit}</div>
                </div>
            `).join('');
        }

        // ========== æ¸²æŸ“å­¦ä¹ æ—¶é•¿å›¾è¡¨ ==========
        function renderTimeChart() {
            if (!learningData) return;
            const ctx = document.getElementById('timeChart').getContext('2d');
            const timeData = getTimeDataForChart(learningData);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeData.labels,
                    datasets: [{
                        label: 'æ¯æ—¥å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰',
                        data: timeData.values,
                        borderColor: '#2e9eb7',
                        backgroundColor: 'rgba(46, 158, 183, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#2e9eb7',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12
                                },
                                color: '#333333'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 10,
                            titleFont: {
                                size: 14
                            },
                            bodyFont: {
                                size: 13
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#666666',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: '#f0f0f0'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#666666',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: '#f0f0f0'
                            }
                        }
                    }
                }
            });
        }

        // ========== æ¸²æŸ“å­¦ä¹ è¿›åº¦å›¾è¡¨ ==========
        async function renderProgressChart() {
            if (!learningData) return;
            const stories = await getAllStories();
            const ctx = document.getElementById('progressChart').getContext('2d');
            const progressData = getProgressDataForChart(learningData);

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['å·²å®Œæˆ', 'è¿›è¡Œä¸­', 'æœªå¼€å§‹'],
                    datasets: [{
                        data: [
                            progressData.completed,
                            progressData.inProgress,
                            progressData.notStarted
                        ],
                        backgroundColor: [
                            '#2e9eb7',
                            '#4dd0e1',
                            '#e0e0e0'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 12
                                },
                                color: '#333333',
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return `${label}: ${value} ç¯‡ (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰æ•…äº‹ï¼ˆæ€»è¿›åº¦ >= 100%ï¼‰
            if (stats && stats.totalProgress >= 100) {
                const celebrationDiv = document.getElementById('completion-celebration');
                if (celebrationDiv) {
                    celebrationDiv.style.display = 'block';
                }
            } else {
                const celebrationDiv = document.getElementById('completion-celebration');
                if (celebrationDiv) {
                    celebrationDiv.style.display = 'none';
                }
            }
        }

        // ========== æ¸²æŸ“å„æ•…äº‹è¿›åº¦åˆ—è¡¨ ==========
        async function renderStoryProgress() {
            const container = document.getElementById('story-progress-list');
            const stories = await getAllStories();

            if (stories.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            </svg>
                        </div>
                        <div class="empty-state-text">æš‚æ— æ•…äº‹æ•°æ®</div>
                    </div>
                `;
                return;
            }

            const html = stories.map((story, index) => {
                const storyId = story.id;
                const progress = getStoryProgress(storyId, learningData);
                const percentage = (progress * 100).toFixed(0);

                return `
                    <div class="story-progress-item">
                        <div class="story-progress-title">${story.title || storyId}</div>
                        <div class="story-progress-bar-container">
                            <div class="story-progress-bar" style="width: ${percentage}%"></div>
                        </div>
                        <div class="story-progress-percentage">${percentage}%</div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // ========== åˆå§‹åŒ–é¡µé¢ ==========
        async function init() {
            // å…ˆåŠ è½½æ•…äº‹æ•°æ®
            await getAllStories();
            
            // è·å–å­¦ä¹ æ•°æ®
            learningData = getLearningData();
            stats = calculateStats(learningData);
            
            renderStatCards();
            renderTimeChart();
            await renderProgressChart();
            await renderStoryProgress();
        }

        // ========== é‡ç½®å­¦ä¹ è¿›åº¦åŠŸèƒ½ ==========
        /**
         * é‡ç½®å­¦ä¹ è¿›åº¦ï¼ˆåªæ¸…ç©ºè¿›åº¦æ•°æ®ï¼Œä¿ç•™æˆå°±æ•°æ®ï¼‰
         * æˆå°±æ•°æ®ï¼ˆæ°¸ä¹…ä¿ç•™ï¼‰ï¼š
         * - LEARNING_SESSIONSï¼ˆå­¦ä¹ æ—¶é•¿è®°å½•ï¼‰
         * çŠ¶æ€æ•°æ®ï¼ˆå¯é‡ç½®ï¼‰ï¼š
         * - STORY_PROGRESSï¼ˆæ•…äº‹æ€»è¿›åº¦ï¼‰
         * - MODE_USAGEï¼ˆæ¨¡å¼ä½¿ç”¨è®°å½•ï¼‰
         * - DETAILED_PROGRESSï¼ˆç»†ç²’åº¦è¿›åº¦ï¼‰
         */
        function resetProgress() {
            // ç¡®è®¤å¼¹çª—
            const confirmed = confirm(
                'ä½ ç¡®å®šè¦å¼€å§‹æ–°ä¸€è½®å­¦ä¹ å—ï¼Ÿ\n\n' +
                'è¿™å°†ä¼šæ¸…ç©ºä½ æ‰€æœ‰æ•…äº‹çš„"å·²å®Œæˆ"æ ‡è®°ï¼Œè®©ä½ å¯ä»¥ä»å¤´å¼€å§‹ã€‚\n\n' +
                'åˆ«æ‹…å¿ƒï¼Œä½ çš„**"ç´¯è®¡å­¦ä¹ æ—¶é•¿"å’Œ"ç´¯è®¡æ‰“å¡å¤©æ•°"å°†ä¼šè¢«æ°¸ä¹…ä¿ç•™**ã€‚'
            );

            if (!confirmed) {
                return;
            }

            // åªæ¸…ç©ºè¿›åº¦ç›¸å…³çš„æ•°æ®
            try {
                // æ¸…ç©ºæ•…äº‹æ€»è¿›åº¦
                localStorage.removeItem('word_novel_story_progress');
                
                // æ¸…ç©ºæ¨¡å¼ä½¿ç”¨è®°å½•
                localStorage.removeItem('word_novel_mode_usage');
                
                // æ¸…ç©ºç»†ç²’åº¦è¿›åº¦
                localStorage.removeItem('word_novel_detailed_progress');
                
                // ä¿ç•™æˆå°±æ•°æ®ï¼š
                // - LEARNING_SESSIONSï¼ˆå­¦ä¹ æ—¶é•¿è®°å½•ï¼‰
                // - DIFFICULT_WORDSï¼ˆç”Ÿè¯æœ¬ï¼‰
                
                console.log('å­¦ä¹ è¿›åº¦å·²é‡ç½®ï¼Œæˆå°±æ•°æ®å·²ä¿ç•™');
                
                // é‡æ–°åŠ è½½é¡µé¢ä»¥æ›´æ–°æ˜¾ç¤º
                alert('é‡ç½®æˆåŠŸï¼ä½ çš„å­¦ä¹ è¿›åº¦å·²æ¸…é›¶ï¼Œä½†æˆå°±æ•°æ®å·²ä¿ç•™ã€‚');
                window.location.reload();
            } catch (error) {
                console.error('é‡ç½®è¿›åº¦æ—¶å‡ºé”™:', error);
                alert('é‡ç½®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚');
            }
        }

        // ========== ç»‘å®šé‡ç½®æŒ‰é’®äº‹ä»¶ ==========
        document.addEventListener('DOMContentLoaded', function() {
            const resetBtn = document.getElementById('reset-progress-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetProgress);
            }
        });

        /* ========== æ•°æ®å¯¼å‡º/å¯¼å…¥åŠŸèƒ½ ========== */

        /**
         * è·å–æ‰€æœ‰å­¦ä¹ æ•°æ®
         * @returns {Object} åŒ…å«æ‰€æœ‰å­¦ä¹ æ•°æ®çš„å¯¹è±¡
         */
        function getAllData() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                learningSessions: getLearningSessions(),
                storyProgress: getStoryProgressData(),
                detailedProgress: getDetailedProgress(),
                difficultWords: getDifficultWords()
            };
            return data;
        }

        /**
         * å¯¼å‡ºæ•°æ®ä¸º JSON æ–‡ä»¶
         */
        function exportData() {
            try {
                const data = getAllData();
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `word-novel-backup-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½åˆ°æ‚¨çš„ä¸‹è½½æ–‡ä»¶å¤¹ã€‚');
            } catch (error) {
                console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        /**
         * ä»æ–‡ä»¶å¯¼å…¥æ•°æ®
         * @param {Event} event - æ–‡ä»¶é€‰æ‹©äº‹ä»¶
         */
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // ç¡®è®¤æ˜¯å¦è¦†ç›–å½“å‰æ•°æ®
            if (!confirm('å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰å­¦ä¹ æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ\n\nå»ºè®®å…ˆå¯¼å‡ºå½“å‰æ•°æ®ä½œä¸ºå¤‡ä»½ã€‚')) {
                event.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!data.version || !data.learningSessions) {
                        throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }
                    
                    // å¯¼å…¥æ•°æ®åˆ° localStorage
                    if (data.learningSessions) {
                        saveLearningSessions(data.learningSessions);
                    }
                    if (data.storyProgress) {
                        saveStoryProgressData(data.storyProgress);
                    }
                    if (data.detailedProgress) {
                        saveDetailedProgress(data.detailedProgress);
                    }
                    if (data.difficultWords) {
                        saveDifficultWords(data.difficultWords);
                    }
                    
                    alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å³å°†åˆ·æ–°ã€‚');
                    window.location.reload();
                } catch (error) {
                    console.error('å¯¼å…¥æ•°æ®å¤±è´¥:', error);
                    alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚');
                }
                
                // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        /**
         * å¤åˆ¶æ•°æ®åˆ°å‰ªè´´æ¿
         */
        function copyDataToClipboard() {
            try {
                const data = getAllData();
                const dataStr = JSON.stringify(data, null, 2);
                
                // ä½¿ç”¨ Clipboard API
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(dataStr).then(() => {
                        alert('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nä½ å¯ä»¥ç²˜è´´åˆ°ç¬”è®°è½¯ä»¶ä¿å­˜ã€‚');
                    }).catch(() => {
                        // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                        fallbackCopyToClipboard(dataStr);
                    });
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    fallbackCopyToClipboard(dataStr);
                }
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·ä½¿ç”¨"å¯¼å‡ºæ•°æ®"åŠŸèƒ½ã€‚');
            }
        }

        /**
         * é™çº§å¤åˆ¶æ–¹æ¡ˆï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰
         */
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (error) {
                console.error('é™çº§å¤åˆ¶å¤±è´¥:', error);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¯¼å‡ºæ•°æ®æ–‡ä»¶ã€‚');
            }
            
            document.body.removeChild(textArea);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('appDataReady', () => {
        init();
    }, { once: true });
    </script>
    <footer class="site-footer">
        <p>Â© 2025 @kylinçš„å°ä¸–ç•Œ. All Rights Reserved.</p>
    </footer>
</body>
</html>

